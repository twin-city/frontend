name: Push Docker image to GitHub container
on:
  release:
    types: [edited, released]
  push:
    branches:
      - feat/ci

jobs:
  build:
    name: 🐳 Build docker image
    runs-on: ubuntu-latest
    steps:
      - name: Check out the repo
        uses: actions/checkout@v2
      - name: Set tag env in artifacts
        run: echo "export APP_VERSION=${GITHUB_REF#refs/*/}" >> artifacts
      - name: Build Static Frontend
        run: make build

  deploy:
    name: 🚀 Deploy
    needs: build
    steps:
      - name: Check out the repo
        uses: actions/checkout@v2
      - name: Push to GitHub Container Registery
        uses: docker/build-push-action@v3
        with:
          push: true
          tags: ghcr.io/twin-city/frontend:latest
          context: "{{defaultContext}}:nginx"
          target: production
          no-cache: false
          #build-args: app_name=, app_ver=
